<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Chatraum – Echtzeit Version</title>
  <style>
    :root{--bg:#f7f7f8;--text:#111;--accent:#0b84ff}
    .dark{--bg:#0b0d11;--text:#e6eef8;--accent:#4da3ff}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui;display:flex;flex-direction:column;height:100vh}
    header{padding:10px 12px;display:flex;justify-content:space-between;align-items:center}
    main{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    .msg{padding:8px 10px;border-radius:12px;max-width:80%;background:#fff}
    .dark .msg{background:#111318}
    .me{align-self:flex-end}
    footer{display:flex;padding:10px;gap:8px}
    input{flex:1;padding:10px;border-radius:10px;border:1px solid #bbb}
    button{padding:10px;border-radius:10px;background:var(--accent);border:none;color:#fff}
  </style>
</head>
<body>
  <header>
    <div id="username"></div>
    <button id="toggleTheme">Modus</button>
  </header>

  <main id="messages"></main>

  <footer>
    <input id="inp" placeholder="Nachricht...">
    <button id="send">Senden</button>
  </footer>

<script>
// Name
let name = localStorage.getItem('chat_name');
if(!name){ name = prompt('Name?') || 'Gast'; localStorage.setItem('chat_name', name);} 
document.getElementById('username').textContent = name;

// Theme
if(localStorage.getItem('chat_dark')==='1') document.documentElement.classList.add('dark');
document.getElementById('toggleTheme').onclick = ()=>{
  const d = document.documentElement.classList.toggle('dark');
  localStorage.setItem('chat_dark', d?'1':'0');
};

// Realtime via BroadcastChannel (für mehrere Geräte/Fenster)
const bc = new BroadcastChannel('chatroom');
bc.onmessage = ev => addMsg(ev.data,false);

// DOM
const msgEl = document.getElementById('messages');
const inp = document.getElementById('inp');

// Nachricht senden
function send(){
  const text = inp.value.trim();
  if(!text) return;
  const msg = {name,text,id:Date.now()+Math.random()};
  addMsg(msg,true);
  bc.postMessage(msg);
  inp.value='';
}

document.getElementById('send').onclick = send;
inp.addEventListener('keydown',e=>{if(e.key==='Enter')send();});

// Nachricht anzeigen
function addMsg(m,save){
  const d = document.createElement('div');
  d.className = 'msg ' + (m.name===name?'me':'other');
  d.textContent = m.name + ': ' + m.text;
  msgEl.appendChild(d);
  msgEl.scrollTop = msgEl.scrollHeight;
}
</script>
</body>
</html>
